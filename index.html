<!DOCTYPE html>
<html lang="en">
<head>
  <title>100% Faith</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="google-spreadsheet.js"></script>
</head>
<body>

<div class="jumbotron text-center" style="padding: 1rem">
  <h1>100% Faith</h1>
  <p>God bless you!</p> 
</div>
  
<div class="container">
  <div class="row">
    <div class="col-sm-2" id="nameList">
    </div>
    <div class="col-sm-1" id="table0">
    </div>
    <div class="col-sm-1" id="table1">
    </div>
    <div class="col-sm-1" id="table2">
    </div>
    <div class="col-sm-1" id="table3">
    </div>
    <div class="col-sm-1" id="table4">
    </div>
    <div class="col-sm-1" id="table5">
    </div>
    <div class="col-sm-1" id="table6">
    </div>
    <div class="col-sm-1" id="table7">
    </div>
    <div class="col-sm-1" id="table8">
    </div>
    <div class="col-sm-1" id="table9">
    </div>
  </div>
</div>

    <script id='script'>
      const pop = array => {
        return array.pop();
      };
      var colors = ["rgba(239, 103, 103, 0.75)", "rgba(239, 191, 103, 0.75)", "rgba(239, 239, 103, 0.75)", "rgba(170, 239, 103, 0.75)", "rgba(103, 239, 219, 0.75)", "rgba(103, 191, 239, 0.75)", "rgba(103, 116, 239, 0.75)", "rgba(150, 103, 239, 0.75)", "rgba(225, 103, 239, 0.75)"];
      var titles = ["發表", "聽發表", "訪問", "學習", "侍奉", "睇影像說教", "祈禱", "睇真理書", "傳道", "實踐母親的教誨"];
      var names = [];
      var dataArr = new Array(10);

      function initDataArr() {
        for (var i = 0; i < 10; i++){
          dataArr[i] = [];
        }
      }

      function createAllTable() {
        for (var i = 0; i < 10; i++) {
          createTable(i);
        }
      }

      function createTable(index) {
        console.log(dataArr[index].length);
        rindex = 600 - dataArr[index].length;
        console.log(rindex);
        var str1 = '#table';
        var selector = str1.concat(index.toString());
        var column = document.querySelector(selector);
        var tbl = document.createElement('table');
        tbl.style.width = '100%';
        tbl.setAttribute('class', 'table table-bordered table-sm');
        var tbdy = document.createElement('tbody');
        for (var i = 0; i < 100; i++) {
          var tr = document.createElement('tr');
          for (var j = 0; j < 6; j++) {
            var td = document.createElement('td');
            // td.style.backgroundColor = "rgba(255, 255, 255, 0.25)";
            if (rindex <= (i*6+j)){
              td.style.backgroundColor = colors[dataArr[index].pop()];
            }
            tr.appendChild(td);
          }
          tbdy.appendChild(tr);
        }
        tbl.appendChild(tbdy);
        column.appendChild(tbl);
        createColumnTitle(column, index);
      }

      function createColumnTitle(column, index) {
        var h6 = document.createElement('h6');
        h6.appendChild(document.createTextNode(titles[index]));
        h6.style.textAlign = "center";
        column.appendChild(h6);
      }

      function updateNameList(names) {
        var div = document.querySelector('#nameList');
        for (var name in names) {
          var h6 = document.createElement('h6');
          h6.appendChild(document.createTextNode(names[name]));
          h6.style.color = colors[name];
          div.appendChild(h6);
        }
      }

      initDataArr();
      localStorage.clear();
      $.getJSON('https://spreadsheets.google.com/feeds/list/1KPV_V51w4_efxruWLZzk7xurdN3gCMEqBGGtfWw0qFU/owj7sdf/public/values?alt=json', function(data) {
        // JSON result in `data` variable
        var entry = data.feed.entry;

        for (var key in data.feed.entry) {
          var obj = data.feed.entry[key];
          var name = obj.gsx$name.$t;
          if (name) {
            if (!names.includes(name)) {
              names.push(name);
            }
            var type = titles.indexOf(obj.gsx$type.$t);
            var units = obj.gsx$units.$t;
            var num = names.indexOf(name);
            for (var i = 0; i < units; i++) {
              dataArr[type].push(num);
            }
          }
        }
        updateNameList(names);
        createAllTable();
      });


    </script>
</body>
</html>

